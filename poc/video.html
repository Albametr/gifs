<!DOCTYPE html>
<html>
<body>

<canvas id="canvas" width="850" height="480" style="display: block;">
Your browser does not support the HTML5 canvas tag.
</canvas>

<video width="850" height="480" id="video" muted autoplay crossorigin="anonymous" src="https://dl.dropboxusercontent.com/u/17361825/test.mp4" controls="true" style="display: block;"></video>

<p>
    <img id="img" width="850" height="480"/>
</p>

<script>

var images = [];
var ctx;
var width = 850;
var img;

window.onload = function() {
    var canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");

    var video = document.getElementById('video');
    img = document.getElementById('img');
    
    var end = 10;

    // caching video frames
    var interval = setInterval(function() {
        if(video.currentTime <= end) {
            ctx.drawImage(video, 0, 0); 
            var urlData = canvas.toDataURL("image/jpg", 0.7);

            images.push(urlData);
            if (images.length == 1)
            {
                draw(0);
            }
        }
        else {
            clearInterval(interval);
            video.pause();
        }
    }, 40);

    // mouse move
    img.onmousemove = function (e) {

    	if (document.all)  { 
    		// IE
      		x = event.x + document.body.scrollLeft; 
      		y = event.y + document.body.scrollTop; 
    	} else {
      		x = e.pageX;
      		y = e.pageY;
    	}

    	var idx = parseInt(x / width * images.length);
    	if (idx >= images.length)
    		idx = images.length - 1;

    	draw(idx);

    };
}



function draw(index) {
	if (index >= images.length)
	{
		return;
	}

	var data = images[index];
    img.src = data;
}

</script>

</body>
</html>
